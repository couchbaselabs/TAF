storage.fusion.fusion_magma_compaction.FusionMagmaCompactionTests:

    # ------------- Crash During Compaction - Graceful Restart -----------------
    # Rebalance In
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=True,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=True,doc_ops=update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=20000000,doc_size=256,graceful=True,doc_ops=create:update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=True,doc_ops=expiry,replicas=1,threads_to_use=120,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=True,doc_ops=create:expiry,durability=MAJORITY,replicas=1,threads_to_use=240,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;graceful

    # Rebalance Out
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=True,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=True,doc_ops=update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=20000000,doc_size=256,graceful=True,doc_ops=create:update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=True,doc_ops=expiry,replicas=1,threads_to_use=120,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=True,doc_ops=create:expiry,durability=MAJORITY,replicas=1,threads_to_use=240,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;graceful

    # Swap Rebalance
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=True,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=True,doc_ops=update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=20000000,doc_size=256,graceful=True,doc_ops=create:update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=True,doc_ops=expiry,replicas=1,threads_to_use=120,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=True,doc_ops=create:expiry,durability=MAJORITY,replicas=1,threads_to_use=240,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;graceful

    # ------------- Crash During Compaction - SIGKILL -----------------
    # Rebalance In
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=False,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=False,doc_ops=update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=20000000,doc_size=256,graceful=False,doc_ops=create:update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=False,doc_ops=expiry,replicas=1,threads_to_use=120,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=False,doc_ops=create:expiry,durability=MAJORITY,replicas=1,threads_to_use=240,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;kill

    # Rebalance Out
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=False,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=False,doc_ops=update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=20000000,doc_size=256,graceful=False,doc_ops=create:update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=False,doc_ops=expiry,replicas=1,threads_to_use=120,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=False,doc_ops=create:expiry,durability=MAJORITY,replicas=1,threads_to_use=240,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;kill

    # Swap Rebalance
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=False,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=False,doc_ops=update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=20000000,doc_size=256,graceful=False,doc_ops=create:update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=False,doc_ops=expiry,replicas=1,threads_to_use=120,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=40000,num_collections=50,doc_size=256,graceful=False,doc_ops=create:expiry,durability=MAJORITY,replicas=1,threads_to_use=240,process_concurrency=2,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;kill

    # ------------- Rollback During Compaction -----------------
    # Rebalance In
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=10000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_before=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=10000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_after=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=7000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_before=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=7000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_after=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P0;rollback

    # Rebalance Out
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=10000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_before=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=10000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_after=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=7000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_before=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=7000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_after=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P0;rollback

    # Swap Rebalance
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=10000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_before=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=10000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_after=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=7000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_before=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=7000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_after=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P0;rollback


        # ------------- Enable Fusion DURING Compaction -----------------
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=True,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P1;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=20000000,doc_size=256,graceful=True,doc_ops=create:update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P1;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=True,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P1;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=True,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P1;graceful
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=False,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P1;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=20000000,doc_size=256,graceful=False,doc_ops=create:update:expiry,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P1;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=False,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P1;kill
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=30000000,doc_size=256,graceful=False,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_swap_rebalance=1,GROUP=P1;kill
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=10000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_before=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_in=1,GROUP=P1;rollback
    test_fusion_test_rollback_during_compaction,nodes_init=3,num_items=10000000,doc_size=256,doc_ops=create:update:expiry:delete,replicas=1,compact_before=True,rollback_items=100000,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,init_loading=False,num_nodes_to_rebalance_out=1,GROUP=P1;rollback

    # ------------- Multiple Buckets Test Cases -----------------
    # Test with 20 buckets - Fusion enabled from start
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=2000,doc_size=8192,graceful=True,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=True,sdk_timeout=60,num_nodes_to_rebalance_in=1,standard_buckets=20,magma_buckets=20,bucket_ram_quota=256,bucket_num_vb=1024,GROUP=P2;multi_bucket
    
    # Test with 20 buckets - Fusion enabled post bucket creation
    test_fusion_test_crash_during_compaction,nodes_init=3,num_items=2000,doc_size=8192,graceful=True,doc_ops=update,replicas=1,fusion_log_store_uri=local:///mnt/nfs/share/buckets,fusion_test=False,enable_fusion_during_compaction=True,sdk_timeout=60,num_nodes_to_rebalance_in=1,standard_buckets=20,magma_buckets=20,bucket_ram_quota=256,bucket_num_vb=1024,GROUP=P2;multi_bucket


